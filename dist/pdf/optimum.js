"use strict";const fs=require("fs"),PDF=require("pdfkit"),path=require("path"),child=require("child_process"),posx={header:{title:{x:120,y:60},address:{x:120,line_1_y:88,line_2_y:101,line_3_y:113},invoice:{x:460,y:98}},data:{patient:{name:{x:60,y:150},age:{x:60,y:167},contact:{x:100,y:167},pid:{x:0,y:150}},doctor:{x:60,name_x:126,y:230},invoice:{x:0,y:230},date:{x:0,y:250}},table:{head:{banner_up:{x:0,y:290},banner_down:{x:612,y:320},proc_x:120,cost_x:310,qty_x:400,total_x:490,y:298},body:{base_proc:{x:80,y:340,max_width:200,max_height:20},cost:{x:310,max_width:35},qty:{x:405,max_width:25},total:{x:490,max_width:60}},foot:{left_x:60,right_x:550,y:610}},total_foot:{x:380,sub_y:620,grand_y:650},payment:{method:{name_x:60,x:160,y:670},id:{name_x:60,x:130,y:690}}};function generateInvoicePDF(a){var b,c,d,e,f,g;const h=new PDF;let i=path.join(__dirname,"..","invoice",a.invoice_number+".pdf"),j="darwin"==process.platform?"open":"win32"==process.platform?"start":"xdg-open";// LOGO
// BORDERS
// 20 BOLD BLUE
// 12 REGULAR BLACK
// 14 REGULAR BLACK
// 14 SEMIBOLD BLACK
console.log(i),h.pipe(fs.createWriteStream(i)),h.image(path.join(__dirname,"logo.png"),60,60,{fit:[70,50],align:"left",valign:"center"}),h.save().moveTo(posx.table.head.banner_up.x,posx.table.head.banner_up.y).lineTo(posx.table.head.banner_up.x,posx.table.head.banner_down.y).lineTo(posx.table.head.banner_down.x,posx.table.head.banner_down.y).lineTo(posx.table.head.banner_down.x,posx.table.head.banner_up.y).fill("#0063A3").save().moveTo(posx.table.foot.left_x,posx.table.foot.y).lineTo(posx.table.foot.right_x,posx.table.foot.y).fill("#CCC"),h.font(path.join(__dirname,"ProximaNova-Bold.ttf")).fontSize(20).fill("#0063A3").text(null!==(b=process.env.CLINIC_NAME)&&void 0!==b?b:"JOHN CLINIC",posx.header.title.x,posx.header.title.y).text("INVOICE",posx.header.invoice.x,posx.header.invoice.y),h.font(path.join(__dirname,"ProximaNova-Regular.ttf")).fontSize(12).fill("#000").text(null!==(c=process.env.CLINIC_ADDRESS_LINE_1)&&void 0!==c?c:"1, John Road",posx.header.address.x,posx.header.address.line_1_y).text(null!==(d=process.env.CLINIC_ADDRESS_LINE_2)&&void 0!==d?d:"80080 08008",posx.header.address.x,posx.header.address.line_2_y).text(null!==(e=process.env.CLINIC_ADDRESS_LINE_3)&&void 0!==e?e:"john@doe.com",posx.header.address.x,posx.header.address.line_3_y).text(null!==(f=a.payment_method)&&void 0!==f?f:null,posx.payment.method.x,posx.payment.method.y).text(null!==(g=a.payment_id)&&void 0!==g?g:null,posx.payment.id.x,posx.payment.id.y),a.treatment.forEach((a,b)=>{var c,d;let e=posx.table.body.base_proc.y+64*b;h.text(a.procedure_done,posx.table.body.base_proc.x,e,{width:posx.table.body.base_proc.max_width,height:posx.table.body.base_proc.max_height}).text(null!==(c=a.treatment_date)&&void 0!==c?c:null).text(a.tooth_number?`Tooth Num: ${a.tooth_number}`:null).text(a.cost,posx.table.body.cost.x,e,{width:posx.table.body.cost.max_width}).text(a.qty,posx.table.body.qty.x,e,{width:posx.table.body.qty.max_width}).text((null===(d=a.total)||void 0===d?void 0:d.toFixed(2))||null,posx.table.body.total.x,e,{width:posx.table.body.total.max_width})}),h.fontSize(14).text(`${a.patient.name}`,posx.data.patient.name.x,posx.data.patient.name.y).text(`${a.patient.gender} / ${a.patient.age}`).text(a.patient.contact).text("Doctor:",posx.data.doctor.x,posx.data.doctor.y).text(a.invoice_date,posx.data.date.x,posx.data.date.y,{align:"right"}).text("Sub Total: Rs.",posx.total_foot.x,posx.total_foot.sub_y).text("Grand Total: Rs.",posx.total_foot.x,posx.total_foot.grand_y),h.font(path.join(__dirname,"ProximaNova-Semibold.ttf")).text(a.doctor,posx.data.doctor.name_x,posx.data.doctor.y).text(a.patient.p_id,posx.data.patient.pid.x,posx.data.patient.pid.y,{align:"right"}).text(a.sub_total.toFixed(2),0,posx.total_foot.sub_y,{align:"right"}).text(a.grand_total.toFixed(2),0,posx.total_foot.grand_y,{align:"right"}).fontSize(16).text(a.invoice_number,posx.data.invoice.x,posx.data.invoice.y,{align:"right"})// 16 SEMIBOLD BLACK
.fontSize(12)// 12 SEMIBOLD BLACK
.text("Payment Method:",posx.payment.method.name_x,posx.payment.method.y).text("Payment ID:",posx.payment.id.name_x,posx.payment.id.y).fill("#FFF")// 12 SEMIBOLD WHITE
.text("TOTAL",posx.table.head.total_x,posx.table.head.y).text("QTY",posx.table.head.qty_x,posx.table.head.y).text("COST",posx.table.head.cost_x,posx.table.head.y).text("PROCEDURE",posx.table.head.proc_x,posx.table.head.y),h.end(),child.exec(j+" "+path.dirname(i))}generateInvoicePDF({patient:{name:"Priya Shankaram",age:30,gender:"F",contact:4350843580,area:"CIT Nagar",p_id:"PAT10201511"},doctor:"Dr. Raahul",treatment:[{procedure_done:"Filling",t_id:"TRT001",tooth_number:[32,10],treatment_date:"2020-12-13T13:04:12.356Z",cost:123456789,qty:2,total:123456789010},{procedure_done:"This will be the detailed description of how a checkup was made for the patients teeth during this treatment visit",t_id:"TRT200",treatment_date:"2020-12-13T13:28:55.279Z",tooth_number:[32,10],cost:100,qty:null,total:100},{procedure_done:"Filling",t_id:"TRT1021",tooth_number:[28]},{procedure_done:"One line can contain maximum of this many",t_id:"TRT999",tooth_number:[1],treatment_date:"2020-12-13T13:04:12.356Z",cost:200,qty:10024520,total:100}],invoice_date:"Dec 10, 2020",invoice_number:"INV29854",sub_total:1200,grand_total:1200,payment_method:"GPay",payment_id:"10E9348DJ3918N398N"});